(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();const e={total:0,deck:[],history:[],historyIndex:-1,currentIndex:0,unvisited:new Set,flipped:!1,shuffle:JSON.parse(localStorage.getItem("fc_shuffle")||"false"),showFavouritesOnly:!1,chapter:null,basePath:"",assetVersion:null,sizes:{},isTransitioning:!1,imagesLoaded:new Set,preloading:new Set,manifest:null,filterTimer:"all",filterDifficulty:"all",formats:null,shuffleQueue:[],navBurstCount:0,navLastTime:0,navFastMode:!1,navQueue:[],lastCardBeforeFavourites:null,wasShuffleBeforeFavourites:!1,revisionMode:JSON.parse(localStorage.getItem("fc_revision_mode")||"false"),revisionIncorrect:new Set,revisionSeen:new Set,revisionRound:1,revisionMastered:new Set};function p(){return e.shuffle?e.history.length===0||e.historyIndex<0||e.historyIndex>=e.history.length?null:e.history[e.historyIndex]:e.deck.length===0||e.currentIndex<0||e.currentIndex>=e.deck.length?null:e.deck[e.currentIndex]}function Se(){return e.deck.slice()}const d=(t,i=document)=>i.querySelector(t);function je(t){for(let i=t.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]]}return t}function be(t){const i=t.slice();return je(i)}function I(t){const i=Number(t);return Number.isFinite(i)&&i>0?i:null}function Ye(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}function ve(t,i,s=600){return new Promise(n=>{let o=!1;const r=l=>{l.animationName===i&&(o=!0,t.removeEventListener("animationend",r),n())};t.addEventListener("animationend",r),setTimeout(()=>{o||(t.removeEventListener("animationend",r),n())},s)})}function U(t){return new Promise(i=>setTimeout(i,t))}const Qe=Object.freeze(Object.defineProperty({__proto__:null,asPositiveInt:I,nowMs:Ye,qs:d,shuffleArray:be,shuffleInPlace:je,wait:U,waitAnimationEnd:ve},Symbol.toStringTag,{value:"Module"})),ht="modulepreload",vt=function(t){return"/"+t},Pe={},P=function(i,s,n){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=vt(c),c in Pe)return;Pe[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":ht,h||(v.as="script"),v.crossOrigin="",v.href=c,a&&v.setAttribute("nonce",a),document.head.appendChild(v),h)return new Promise((y,m)=>{v.addEventListener("load",y),v.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return o.then(l=>{for(const a of l||[])a.status==="rejected"&&r(a.reason);return i().catch(r)})},ze=[],qe="ch",We="_cartes",Be=20,mt=100,le=2,M=5,yt="1.0",pt=2,gt=450,wt=["webp","png"],Ue="fc_last_card_",ce=["all","green","yellow","orange"],de=["all","green","orange","red"],H=new Map,$=new Map,fe=new Map,Q=new Map,Ie=new Map,me=new Map,$e=new Map;function ye(t,i=!0){if(i&&H.has(t))return Promise.resolve(H.get(t));if($.has(t))return $.get(t);const s=new Promise(n=>{const o=new Image;o.onload=()=>{const r={ok:!0,width:o.naturalWidth,height:o.naturalHeight,src:t};i&&H.set(t,r),$.delete(t),n(r)},o.onerror=()=>{const r={ok:!1,src:t};$.delete(t),n(r)},o.src=t});return $.set(t,s),s}function kt(t){const i=t.includes("?")?"&":"?";return ye(`${t}${i}probe=${Date.now()}`,!1)}function Ke(t,i,s){if(s==null||s==="")return t;const n=t.includes("?")?"&":"?";return`${t}${n}${encodeURIComponent(i)}=${encodeURIComponent(s)}`}function St(t,i=Date.now().toString(36)){return Ke(t,"cb",i)}function q(t){return typeof t=="string"?t.trim().toLowerCase():""}function bt(t){if(!t||typeof t!="object")return null;const i=[t.asset_version,t.assetVersion,t.cache_bust,t.cacheBust,t.version,t.generated_at,t.generatedAt,t.updated_at,t.updatedAt];for(const s of i){if(s==null)continue;const n=String(s).trim();if(n)return n}return null}function pe(t,i){if(!t)return null;const s=bt(i);return s?me.set(t,s):me.delete(t),s}function It(t=e.basePath){return t?t===e.basePath&&e.assetVersion?e.assetVersion:me.get(t)||null:null}function Tt(t){if(!t||typeof t!="object")return null;const i={},s=t.image_formats||t.formats;if(s&&typeof s=="object"&&(s.front&&(i.front=q(s.front)),s.back&&(i.back=q(s.back)),s.default&&(i.default=q(s.default))),t.image_format){const o=q(t.image_format);o&&(i.front||(i.front=o),i.back||(i.back=o),i.default||(i.default=o))}return Object.keys(i).length?(i.default||(i.front&&i.back&&i.front===i.back||i.front?i.default=i.front:i.back&&(i.default=i.back)),!i.front&&i.default&&(i.front=i.default),!i.back&&i.default&&(i.back=i.default),i):null}function Ge(t,i){if(!t)return null;const s=Tt(i);return s&&Ie.set(t,s),s}function Te(t){return Ie.get(t)||null}function Lt(t,i=e.basePath){if(!i)return[];const s=i===e.basePath&&e.formats||Ie.get(i);if(!s)return[];const n=[];return s[t]&&n.push(s[t]),s.default&&n.push(s.default),Array.from(new Set(n.filter(Boolean)))}function xt(t,i,s){return`${t}|${i}|${s}`}function _t(t,i,s,n){let o=`${t}/${i}${s}.${n}`;const r=It(t);return r&&(o=Ke(o,"v",r)),o}async function Je(t,{forceReload:i=!1}={}){if(!t)return null;if(!i&&fe.has(t)){const o=fe.get(t);return pe(t,o),o}if(Q.has(t))return Q.get(t);const s=`${t}/manifest.json`,n=fetch(s,{cache:i?"reload":"no-cache"}).then(o=>o.ok?o.json():null).catch(()=>null).then(o=>(Q.delete(t),o&&(fe.set(t,o),Ge(t,o),pe(t,o)),o));return Q.set(t,n),n}async function Ze(t,i,s={}){const{basePath:n=e.basePath,probe:o=!1,useCache:r=!0}=s;if(!n)return{ok:!1,src:""};const l=xt(n,t,i),a=$e.get(l),c=Lt(t,n),h=[];a&&h.push(a),c.forEach(y=>h.push(y)),wt.forEach(y=>h.push(y));const u=Array.from(new Set(h.filter(Boolean)));if(!u.length)return{ok:!1,src:""};let v="";for(const y of u){const m=_t(n,t,i,y);v=m;let S=!1,w=o?await kt(m):await ye(m,r);if(!o&&!w.ok){const f=St(m);v=f,w=await ye(f,!1),S=!0}if(w.ok)return w.ext=y,$e.set(l,y),w.src||(w.src=v||m),S&&r&&!H.has(m)&&H.set(m,{...w}),w}return{ok:!1,src:v}}function A(t,i){return Ze("front",t,i)}function X(t,i){return Ze("back",t,i)}function et(){return`fc_favourites_ch${e.chapter}`}function ne(){const t=et(),i=localStorage.getItem(t);return i?new Set(JSON.parse(i)):new Set}function Mt(t){const i=et();localStorage.setItem(i,JSON.stringify(Array.from(t)))}function De(t){const i=ne();return i.has(t)?i.delete(t):i.add(t),Mt(i),i.has(t)}function Le(){return`fc_history_ch${e.chapter}`}function z(){if(!e.shuffle||!e.chapter)return;const t=Le(),i=e.history.slice(-M);localStorage.setItem(t,JSON.stringify(i))}function tt(){if(!e.chapter)return[];const t=Le(),i=localStorage.getItem(t);if(!i)return[];try{const s=JSON.parse(i);if(Array.isArray(s))return s.filter(n=>e.deck.includes(n)).slice(-M)}catch{}return[]}function At(){if(!e.chapter)return;const t=Le();localStorage.removeItem(t)}function xe(){return`fc_revision_ch${e.chapter}`}function oe(){if(!e.chapter||!e.revisionMode)return;const t=xe(),i={round:e.revisionRound,incorrect:Array.from(e.revisionIncorrect),seen:Array.from(e.revisionSeen),mastered:Array.from(e.revisionMastered)};localStorage.setItem(t,JSON.stringify(i))}function it(){if(!e.chapter)return null;const t=xe(),i=localStorage.getItem(t);if(!i)return null;try{const s=JSON.parse(i);return{round:s.round||1,incorrect:new Set(s.incorrect||[]),seen:new Set(s.seen||[]),mastered:new Set(s.mastered||[])}}catch{return null}}function Ct(){if(!e.chapter)return;const t=xe();localStorage.removeItem(t)}function Ot(t){if(!t)return null;const i=localStorage.getItem(`${Ue}${t}`),s=parseInt(i,10);return Number.isFinite(s)?s:null}function st(t){if(!(!e.chapter||!t))try{localStorage.setItem(`${Ue}${e.chapter}`,String(t))}catch{}}const T={cardFlip:"Card flipped",nextButton:"Next button",modeToggle:"Mode toggle",randomToggle:"Random toggle",favouritesToggle:"Favourites toggle",filterGroup:"Filter group"};function L(t,i){t&&window.umami&&typeof window.umami.track=="function"&&(i?window.umami.track(t,i):window.umami.track(t))}function D(t){if(!t||e.imagesLoaded.has(t)||e.preloading.has(t))return;const i=()=>{const s=A(t).then(o=>{o&&o.ok&&o.width&&o.height&&(e.sizes[t]={w:o.width,h:o.height})}),n=X(t);Promise.all([s,n]).catch(()=>{}).finally(()=>{e.preloading.delete(t)})};e.preloading.add(t),"requestIdleCallback"in window?requestIdleCallback(()=>{i()},{timeout:1500}):setTimeout(()=>{i()},120)}function Et(){if(e.shuffle){const t=Array.from(e.unvisited),i=Math.min(le,t.length);for(let s=0;s<i;s++){const n=Math.floor(Math.random()*t.length);D(t[n])}for(let s=1;s<=le;s++)e.historyIndex-s>=0&&D(e.history[e.historyIndex-s]),e.historyIndex+s<e.history.length&&D(e.history[e.historyIndex+s])}else for(let t=1;t<=le;t++){const i=(e.currentIndex+t)%e.deck.length,s=(e.currentIndex-t+e.deck.length)%e.deck.length;e.deck[i]&&D(e.deck[i]),e.deck[s]&&D(e.deck[s])}}let ue=0,W=!1;function Rt(){if(!document.body)return;const t=!!d(".modal.show");t&&!W?(ue=window.scrollY||window.pageYOffset||0,document.body.style.top=`-${ue}px`,document.body.classList.add("modal-open"),W=!0):!t&&W&&(document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo(0,ue),W=!1)}function N(t,i){t&&(t.classList.toggle("show",i),Rt())}function re(){d("#skeleton").classList.add("visible")}function E(){d("#skeleton").classList.remove("visible")}function F(t,i){const s=d("#stage"),n=Math.min(window.innerWidth*.9,900),o=window.innerHeight-300,l=Math.max(o,200)*(t/i),a=Math.min(n,l),c=a*(i/t);s.style.width=`${a}px`,s.style.height=`${c}px`}function K(t){e.flipped=t,L(T.cardFlip,{mode:e.revisionMode?"revision":"lecture",side:t?"back":"front"});const i=d("#card3d");i.classList.add("flipping"),setTimeout(()=>i.classList.remove("flipping"),600),i.classList.toggle("flipped",t),i.setAttribute("aria-pressed",String(t))}async function k(t="none",i={}){if(e.isTransitioning)return;const s=!!i.keepHidden,n=p();if(!n)return;const o=e.sizes[n];o&&o.w>0&&o.h>0&&F(o.w,o.h);const r=d("#cardShell"),l=d("#card3d"),a=d("#frontImg"),c=d("#backImg");!e.imagesLoaded.has(n)&&re(),e.isTransitioning=!0;const u=()=>{e.isTransitioning=!1,C(),n&&st(n),Et(),Ft()},v=async()=>{e.flipped&&(l.classList.add("no-anim"),l.classList.remove("flipped","flipping"),l.setAttribute("aria-pressed","false"),e.flipped=!1,l.offsetHeight,l.classList.remove("no-anim")),a.classList.remove("loaded"),c.classList.remove("loaded");const[g,b]=await Promise.all([A(n),X(n)]);g&&g.ok&&g.width&&g.height?(e.sizes[n]={w:g.width,h:g.height},F(g.width,g.height)):b&&b.ok&&b.width&&b.height&&(e.sizes[n]={w:b.width,h:b.height},F(b.width,b.height)),a.src=g.src,c.src=b.src;try{a.decode&&c.decode?await Promise.all([a.decode(),c.decode()]):await Promise.all([new Promise(_=>{a.complete?_():a.onload=_}),new Promise(_=>{c.complete?_():c.onload=_})])}catch{await Promise.all([new Promise(O=>{a.complete?O():a.onload=O}),new Promise(O=>{c.complete?O():c.onload=O})])}e.imagesLoaded.add(n),a.classList.add("loaded"),c.classList.add("loaded"),s||(r.style.opacity="",r.style.visibility="",r.style.transition=""),E(),x(),ee()};if(t==="none"){await v(),u();return}const y=t==="next"?"out-left":"out-right",m=t==="next"?"outLeft":"outRight",S=t==="next"?"in-right":"in-left",w=t==="next"?"inRight":"inLeft",f=!!(i&&i.instant);if(r.classList.remove("out-left","out-right","in-left","in-right"),r.offsetWidth,f){await v(),u();return}r.classList.add(y),await ve(r,m,400),await v(),r.classList.remove(y),r.offsetWidth,r.classList.add(S),await ve(r,w,500),r.classList.remove(S),u()}function x(){const t=d("#counter");if(!e.deck.length){e.showFavouritesOnly?t.textContent="Aucun favori disponible.":t.textContent="Aucune image trouvée.";return}const i=p();if(!i){t.textContent="Aucune carte sélectionnée.";return}if(e.revisionMode){const n=Se().length-e.revisionSeen.size,o=e.revisionRound>1?`Tour ${e.revisionRound} · `:"";n>0?t.textContent=`${o}${n} carte${n>1?"s":""} restante${n>1?"s":""}`:t.textContent=`${o}Dernière carte !`}else if(e.showFavouritesOnly){const s=e.deck.indexOf(i),n=s>=0?s+1:i||"?";t.textContent=`Favori ${n} sur ${e.deck.length}`}else t.textContent=`Carte n°${i}, ${e.deck.length} résultats`}function ee(){const t=d("#bookmarkBtn");if(!t)return;const i=p(),n=ne().has(i);t.classList.toggle("active",n),t.setAttribute("aria-pressed",String(n));const o=t.querySelector(".btn-text");o&&(o.textContent=n?"Retirer":"Ajouter"),t.setAttribute("aria-label",n?"Retirer des favoris":"Ajouter aux favoris")}function ge(){const t=ne().size,i=d("#favouritesCount");i&&(i.textContent=t.toString())}function C(){const t=d("#prevBtn"),i=d("#nextBtn");e.shuffle?t&&(t.disabled=e.historyIndex<=0):t&&(t.disabled=!1),i&&(i.disabled=e.deck.length===0)}function j(){var v,y;const t=d("#modeToggle");if(t){t.classList.toggle("active",e.revisionMode);const m=t.querySelector(".toggle-text");m&&(m.textContent=e.revisionMode?"Lecture":"Révision")}const i=d("#prevBtn"),s=d("#nextBtn"),n=d("#bookmarkBtn"),o=d("#pasOkBtn"),r=d("#okBtn");e.revisionMode?(i&&(i.style.display="none"),s&&(s.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display=""),r&&(r.style.display="")):(i&&(i.style.display=""),s&&(s.style.display=""),n&&(n.style.display=""),o&&(o.style.display="none"),r&&(r.style.display="none"));const l=d("#randomToggle"),a=d("#favouritesToggle"),c=(v=d("#timerFilter"))==null?void 0:v.closest(".filter-group"),h=(y=d("#difficultyFilter"))==null?void 0:y.closest(".filter-group");e.revisionMode?(l&&(l.style.display="none"),a&&(a.style.display="none"),c&&(c.style.display="none"),h&&(h.style.display="none")):(l&&(l.style.display=""),a&&(a.style.display=""),c&&(c.style.display=""),h&&(h.style.display=""));const u=d("#restartRevisionInlineBtn");u&&(u.style.display=e.revisionMode?"":"none")}function Y(){const t=d("#randomToggle");if(!t)return;const i=e.showFavouritesOnly||e.revisionMode;t.classList.toggle("active",e.shuffle),t.classList.toggle("disabled",i),t.setAttribute("aria-checked",String(e.shuffle)),t.setAttribute("aria-disabled",String(i)),t.setAttribute("tabindex",i?"-1":"0")}function ae(){const t=d("#favouritesToggle");if(!t)return;const i=e.revisionMode;t.classList.toggle("active",e.showFavouritesOnly),t.classList.toggle("disabled",i),t.setAttribute("aria-checked",String(e.showFavouritesOnly)),t.setAttribute("aria-disabled",String(i)),t.setAttribute("tabindex",i?"-1":"0")}function _e(){const t=d("#timerFilter");t&&t.setAttribute("data-level",e.filterTimer)}function Me(){const t=d("#difficultyFilter");t&&t.setAttribute("data-level",e.filterDifficulty)}function G(){if(e.revisionMode)return;const i=(ce.indexOf(e.filterTimer)+1)%ce.length;e.filterTimer=ce[i],L(T.filterGroup,{group:"timer",level:e.filterTimer}),_e();const s=p();if(B(s),!e.deck.length){d("#counter").textContent="Aucune carte disponible pour ce filtre.",E(),C();return}k()}function J(){if(e.revisionMode)return;const i=(de.indexOf(e.filterDifficulty)+1)%de.length;e.filterDifficulty=de[i],L(T.filterGroup,{group:"difficulty",level:e.filterDifficulty}),Me();const s=p();if(B(s),!e.deck.length){d("#counter").textContent="Aucune carte disponible pour ce filtre.",E(),C();return}k()}const nt=Object.freeze(Object.defineProperty({__proto__:null,cycleDifficulty:J,cycleTimer:G,hideSkeleton:E,setFlipped:K,setModalVisibility:N,showCurrent:k,showSkeleton:re,sizeStageForImage:F,updateBookmarkButton:ee,updateCounter:x,updateDifficultyUI:Me,updateFavouritesCount:ge,updateFavouritesUI:ae,updateNavButtons:C,updateRevisionUI:j,updateShuffleUI:Y,updateTimerUI:_e},Symbol.toStringTag,{value:"Module"}));function Ae(){e.navBurstCount=0,e.navLastTime=0,e.navFastMode=!1,e.navQueue=[]}function ot(){if(e.revisionMode)return Ae(),!1;const t=Ye();return t-e.navLastTime<=gt?e.navBurstCount+=1:e.navBurstCount=1,e.navLastTime=t,e.navFastMode=e.navBurstCount>pt,e.navFastMode}function rt(t){e.revisionMode||(Array.isArray(e.navQueue)||(e.navQueue=[]),e.navQueue.push(t))}function Ft(){if(e.revisionMode){e.navQueue=[];return}if(!Array.isArray(e.navQueue)||e.navQueue.length===0||e.isTransitioning)return;const t=e.navQueue.shift();t==="next"?we({queued:!0}):t==="prev"&&ke({queued:!0})}function te(t){if(e.shuffle&&(Array.isArray(e.shuffleQueue)||(e.shuffleQueue=[]),e.shuffleQueue.length===0)){e.unvisited.size===0&&(e.unvisited=new Set(e.deck),t&&e.unvisited.delete(t));const i=Array.from(e.unvisited);e.shuffleQueue=be(i)}}function B(t=null){const{total:i,manifest:s}=e;let n=null;if(s&&s.per_card&&typeof s.per_card=="object"){const o=Array.from(new Set(Object.keys(s.per_card).map(r=>I(r)).filter(Boolean))).sort((r,l)=>r-l);o.length&&(n=o)}if(!n)n=Array.from({length:i},(o,r)=>r+1);else if(i&&n.length<i){const o=new Set(n);for(let r=1;r<=i;r++)o.has(r)||n.push(r)}if(s){const o=new Set;if(s.per_card&&typeof s.per_card=="object")for(const[a,c]of Object.entries(s.per_card))c&&c.border==="purple"&&o.add(parseInt(a,10));else s.cards_by_border&&Array.isArray(s.cards_by_border.purple)&&s.cards_by_border.purple.forEach(a=>o.add(parseInt(a,10)));o.size&&(n=n.filter(a=>!o.has(a)));const r=e.filterTimer;if(r&&r!=="all"){const a=new Set;if(s.cards_by_timer&&Array.isArray(s.cards_by_timer[r]))s.cards_by_timer[r].forEach(c=>a.add(parseInt(c,10)));else if(s.per_card&&typeof s.per_card=="object")for(const[c,h]of Object.entries(s.per_card))h&&h.timer===r&&a.add(parseInt(c,10));a.size?n=n.filter(c=>a.has(c)):n=[]}const l=e.filterDifficulty;if(l&&l!=="all"){const a=new Set;if(s.cards_by_border&&Array.isArray(s.cards_by_border[l]))s.cards_by_border[l].forEach(c=>a.add(parseInt(c,10)));else if(s.per_card&&typeof s.per_card=="object")for(const[c,h]of Object.entries(s.per_card))h&&h.border===l&&a.add(parseInt(c,10));a.size?n=n.filter(c=>a.has(c)):n=[]}}if(e.showFavouritesOnly){const o=ne();n=n.filter(r=>o.has(r))}if(n.sort((o,r)=>o-r),e.deck=n,e.shuffle){if(t!==null&&n.includes(t))e.history.includes(t)||(e.history=[t]),e.historyIndex=e.history.indexOf(t),e.historyIndex<0&&(e.historyIndex=0);else if(e.history=e.history.filter(o=>n.includes(o)),e.history.length===0&&n.length>0){const o=Math.floor(Math.random()*n.length);e.history=[n[o]],e.historyIndex=0}else e.historyIndex=Math.min(e.historyIndex,e.history.length-1);e.unvisited=new Set(n),e.history.forEach(o=>e.unvisited.delete(o)),e.shuffleQueue=[]}else t!==null&&n.includes(t)?e.currentIndex=n.indexOf(t):e.currentIndex=0}function we(t={}){const{queued:i=!1}=t;if(!e.deck.length)return;if(!i&&!e.revisionMode&&ot(),e.isTransitioning){!e.revisionMode&&!i&&rt("next");return}const n=!e.revisionMode&&e.navFastMode?{instant:!0}:void 0;if(e.shuffle){if(e.historyIndex<e.history.length-1){e.historyIndex++,z(),k("next",n);return}const o=p();let r=null;te(o),e.shuffleQueue.length>0?r=e.shuffleQueue.pop():e.deck.length>0&&(r=e.deck[0]),r!==null&&(e.history.push(r),e.history.length>M?(e.history.shift(),e.historyIndex=M-1):e.historyIndex++,e.unvisited.delete(r),te(r),z(),k("next",n))}else e.currentIndex=(e.currentIndex+1)%e.deck.length,k("next",n)}function ke(t={}){const{queued:i=!1}=t;if(!e.deck.length||!(e.shuffle?e.historyIndex>0:!0))return;if(!i&&!e.revisionMode&&ot(),e.isTransitioning){!e.revisionMode&&!i&&rt("prev");return}const o=!e.revisionMode&&e.navFastMode?{instant:!0}:void 0;e.shuffle?(e.historyIndex--,k("prev",o)):(e.currentIndex=(e.currentIndex-1+e.deck.length)%e.deck.length,k("prev",o))}function Z(){if(!(e.showFavouritesOnly&&!e.shuffle)){if(e.shuffle=!e.shuffle,localStorage.setItem("fc_shuffle",JSON.stringify(e.shuffle)),e.shuffle){const t=p(),i=tt();i.length>0&&i[i.length-1]===t?(e.history=i,e.historyIndex=i.length-1):(e.history=t?[t]:[],e.historyIndex=t?0:-1),e.unvisited=new Set(e.deck),e.history.forEach(s=>e.unvisited.delete(s)),e.shuffleQueue=[],z()}else{At();const t=p();t&&(e.currentIndex=e.deck.indexOf(t),e.currentIndex===-1&&(e.currentIndex=0)),e.shuffleQueue=[]}te(p()),Y(),x(),C()}}async function he(){if(e.isTransitioning)return;!e.showFavouritesOnly&&(e.lastCardBeforeFavourites=p(),e.wasShuffleBeforeFavourites=e.shuffle),e.showFavouritesOnly=!e.showFavouritesOnly;let i;if(e.showFavouritesOnly?(i=p(),e.shuffle&&(Z(),i=p())):(i=e.lastCardBeforeFavourites,e.wasShuffleBeforeFavourites&&!e.shuffle&&(e.shuffle=!0,localStorage.setItem("fc_shuffle","true"))),B(i),ae(),Y(),!e.deck.length){const{qs:s}=await P(async()=>{const{qs:o}=await Promise.resolve().then(()=>Qe);return{qs:o}},void 0),{hideSkeleton:n}=await P(async()=>{const{hideSkeleton:o}=await Promise.resolve().then(()=>nt);return{hideSkeleton:o}},void 0);s("#counter").textContent="Aucun favori disponible.",n(),C();return}k()}function Ce(){e.revisionRound=1,e.revisionIncorrect=new Set,e.revisionSeen=new Set,e.revisionMastered=new Set,Ct()}function Oe(t=null){const i=Se();if(e.unvisited=new Set(i),e.history=[],e.historyIndex=-1,!i.length){e.shuffleQueue=[];return}let s=t;if(s==null||!e.unvisited.has(s)){const n=Math.floor(Math.random()*i.length);s=i[n]}e.history=[s],e.historyIndex=0,e.unvisited.delete(s),e.shuffleQueue=be(Array.from(e.unvisited)),z()}function Ee(){const t=Se();return e.revisionSeen.size>=t.length}function Pt(){e.revisionRound++,e.revisionSeen=new Set,e.revisionIncorrect.size>0&&(e.deck=Array.from(e.revisionIncorrect)),oe(),Oe(),k(),j(),x()}function V(){e.revisionIncorrect.size===0?zt():Pt()}function zt(){const t=d("#revisionCompleteModal");if(t){const i=d("#revisionRounds"),s=d("#revisionRoundsPlural"),n=d("#revisionRoundsPlural2");i&&(i.textContent=e.revisionRound.toString()),s&&(s.textContent=e.revisionRound>1?"s":""),n&&(n.textContent=e.revisionRound>1?"s":""),N(t,!0)}}function at(){if(!e.deck.length)return;const t=e.deck.filter(n=>!e.revisionSeen.has(n));if(t.length===0){V();return}const i=Math.floor(Math.random()*t.length),s=t[i];e.history.push(s),e.history.length>M?(e.history.shift(),e.historyIndex=M-1):e.historyIndex++,e.unvisited.delete(s),z(),Bt(),x()}async function Bt(){const t=d("#cardShell");if(!t){k();return}const{swipeGesture:i}=await P(async()=>{const{swipeGesture:s}=await Promise.resolve().then(()=>ct);return{swipeGesture:s}},void 0);i.resetCardTransform(),t.style.transition="none",t.style.transform="",t.style.opacity="0",t.style.visibility="hidden",t.offsetWidth,await k("none",{keepHidden:!0}),t.classList.add("scaling-in"),t.style.visibility="",t.style.opacity="",setTimeout(()=>{t.classList.remove("scaling-in"),t.style.transition=""},300)}async function ie(t,i){const s=d("#cardShell");if(!s)return;e.isTransitioning=!0;const{swipeGesture:n}=await P(async()=>{const{swipeGesture:r}=await Promise.resolve().then(()=>ct);return{swipeGesture:r}},void 0);n.resetCardTransform(),s.style.transform="",s.offsetWidth;const o=t==="right"?"swiping-right":"swiping-left";s.classList.add(o),setTimeout(()=>{s.style.transition="none",s.style.opacity="0",s.style.visibility="hidden",s.offsetWidth,s.classList.remove(o),s.style.transform="",e.isTransitioning=!1,i&&i()},300)}function He(){const t=p();t&&(e.revisionIncorrect.delete(t),e.revisionMastered.add(t),e.revisionSeen.add(t),oe(),Ee()?ie("right",()=>V()):ie("right",()=>at()))}function Xe(){const t=p();t&&(e.revisionIncorrect.add(t),e.revisionSeen.add(t),e.revisionMastered.delete(t),oe(),Ee()?ie("left",()=>V()):ie("left",()=>at()))}function Ne(){if(e.revisionMode){if(Ce(),B(),!e.deck.length){x();return}e.shuffle||(e.shuffle=!0,localStorage.setItem("fc_shuffle","true")),Oe(),k(),j(),x()}}function Ve(){const t=p();if(e.revisionMode=!e.revisionMode,localStorage.setItem("fc_revision_mode",JSON.stringify(e.revisionMode)),Ae(),document.body.classList.toggle("mode-revision",e.revisionMode),e.revisionMode){const i=it();i?(e.revisionRound=i.round,e.revisionIncorrect=i.incorrect,e.revisionSeen=i.seen,e.revisionMastered=i.mastered,e.revisionRound>1&&e.revisionIncorrect.size>0&&(e.deck=Array.from(e.revisionIncorrect))):Ce(),e.shuffle||(e.shuffle=!0,localStorage.setItem("fc_shuffle","true")),Oe(t),e.showFavouritesOnly&&(e.showFavouritesOnly=!1)}else{const i=p();B(i)}j(),Y(),ae(),x(),k()}async function $t(){if(ze.length)return ze.slice();const t=[],i=5;for(let s=1;s<=Be;s+=i){const n=[];for(let l=s;l<Math.min(s+i,Be+1);l++){const a=`flashcards/${qe}${l}${We}`;n.push((async()=>await Je(a).catch(()=>null)||(await A(1,{basePath:a})).ok?l:null)())}const r=(await Promise.all(n)).filter(l=>l!==null);if(t.push(...r),r.length<n.length)break}return t}function Dt(t){e.chapter=t,e.basePath=`flashcards/${qe}${t}${We}`,e.formats=Te(e.basePath)||null,e.assetVersion=null}function Ht(t){const i={total:0,hasSizes:!1,defaultSize:null};if(!t||typeof t!="object")return i;Number.isFinite(t.total_cards)&&(i.total=Number(t.total_cards));const s=Ge(e.basePath,t);s&&(e.formats=s);let n=i.total,o=!1;if(t.per_card&&typeof t.per_card=="object")for(const[l,a]of Object.entries(t.per_card)){const c=I(l);if(c&&(c>n&&(n=c),a&&typeof a=="object")){let h=null,u=null;a.front&&typeof a.front=="object"&&(h=I(a.front.width),u=I(a.front.height)),(!h||!u)&&(h=I(a.width),u=I(a.height)),h&&u&&(e.sizes[c]={w:h,h:u},o=!0)}}n>i.total&&(i.total=n),i.hasSizes=o;const r=t.card_dimensions;if(r&&typeof r=="object"){const l=r.front&&typeof r.front=="object"?r.front:r,a=I(l.width),c=I(l.height);a&&c&&(i.defaultSize={w:a,h:c})}return i}async function Xt(t={}){if(e.manifest=null,!e.basePath)return e.formats=null,e.assetVersion=null,{manifest:null,info:{total:0,hasSizes:!1}};const i=await Je(e.basePath,t);e.manifest=i,e.assetVersion=pe(e.basePath,i),e.formats=Te(e.basePath)||e.formats;const s=Ht(i);if(s.defaultSize&&s.total){for(let n=1;n<=s.total;n++)e.sizes[n]||(e.sizes[n]={...s.defaultSize});s.hasSizes=!0}return{manifest:i,info:s}}async function Nt(){let t=1,i=mt,s=0;for(;t<=i;){const n=Math.floor((t+i)/2),[o,r]=await Promise.all([A(n),X(n)]);o.ok&&r.ok?(s=n,e.sizes[n]={w:o.width,h:o.height},t=n+1):i=n-1}if(s>0){const n=[];for(let o=1;o<=s;o++)e.sizes[o]||n.push(A(o).then(r=>{r.ok&&(e.sizes[o]={w:r.width,h:r.height})}));await Promise.all(n)}return s}async function Vt(t){if(!t)return;const i=[];for(let n=1;n<=t;n++)e.sizes[n]||i.push(n);const s=6;for(;i.length;){const n=i.splice(0,s);await Promise.all(n.map(o=>A(o).then(r=>{r.ok&&r.width&&r.height&&(e.sizes[o]={w:r.width,h:r.height})})))}}async function lt(t){const{qs:i}=await P(async()=>{const{qs:a}=await Promise.resolve().then(()=>Qe);return{qs:a}},void 0),{updateFavouritesCount:s}=await P(async()=>{const{updateFavouritesCount:a}=await Promise.resolve().then(()=>nt);return{updateFavouritesCount:a}},void 0);if(re(),Dt(t),s(),e.sizes={},e.total=0,e.deck=[],e.history=[],e.historyIndex=-1,e.currentIndex=0,e.unvisited.clear(),e.shuffleQueue=[],e.imagesLoaded.clear(),e.preloading.clear(),e.formats=Te(e.basePath)||null,Ae(),e.revisionMode){const a=it();a?(e.revisionRound=a.round,e.revisionIncorrect=a.incorrect,e.revisionSeen=a.seen,e.revisionMastered=a.mastered):Ce()}const{info:n}=await Xt();let o=n.total||0,r=n.hasSizes;if(o?!r&&o>0&&(await Vt(o),r=!0):(o=await Nt(),r=!0),e.total=o,!o){E(),i("#counter").textContent=`Aucune image de carte trouvée dans "${e.basePath}".`,C();return}const l=Ot(e.chapter);if(B(l),e.revisionMode&&e.revisionRound>1&&e.revisionIncorrect.size>0&&(e.deck=e.deck.filter(a=>e.revisionIncorrect.has(a))),!e.deck.length){E(),i("#counter").textContent="Aucune carte disponible.",C();return}if(e.shuffle){const a=tt();if(a.length>0)e.history=a,e.historyIndex=a.length-1,e.unvisited=new Set(e.deck),a.forEach(c=>e.unvisited.delete(c)),e.shuffleQueue=[];else if(l&&e.deck.includes(l))e.history=[l],e.historyIndex=0,e.unvisited=new Set(e.deck),e.unvisited.delete(l),e.shuffleQueue=[];else{const c=Math.floor(Math.random()*e.deck.length),h=e.deck[c];e.history=[h],e.historyIndex=0,e.unvisited=new Set(e.deck),e.unvisited.delete(h),e.shuffleQueue=[]}}else l&&e.deck.includes(l)?e.currentIndex=e.deck.indexOf(l):e.currentIndex=0;te(),await k()}const se={THRESHOLD_RATIO:.25,VELOCITY_THRESHOLD:.3,MAX_ROTATION:15,VERTICAL_FACTOR:.1,VELOCITY_SAMPLES:5,isActive:!1,startX:0,startY:0,currentX:0,currentY:0,deltaX:0,deltaY:0,velocityHistory:[],cardShell:null,zoneOk:null,zoneReview:null,isTouchDevice:!1,hasMovedHorizontally:!1,rafId:null,init(){this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.isTouchDevice&&(this.cardShell=d("#cardShell"),this.zoneOk=d(".swipe-zone-ok"),this.zoneReview=d(".swipe-zone-review"),this.cardShell&&(this.cardShell.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.cardShell.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.cardShell.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),this.cardShell.addEventListener("touchcancel",this.onTouchCancel.bind(this),{passive:!0})))},getThreshold(){return window.innerWidth*this.THRESHOLD_RATIO},onTouchStart(t){if(!e.revisionMode||e.isTransitioning||t.touches.length!==1)return;const i=t.touches[0];this.startX=i.clientX,this.startY=i.clientY,this.currentX=i.clientX,this.currentY=i.clientY,this.deltaX=0,this.deltaY=0,this.velocityHistory=[],this.hasMovedHorizontally=!1,this.isActive=!0,this.cardShell.classList.add("swiping"),document.body.classList.add("revision-active"),this.startRaf()},startRaf(){this.rafId&&cancelAnimationFrame(this.rafId);const t=()=>{this.isActive&&(this.updateCardTransform(),this.updateZones(),this.rafId=requestAnimationFrame(t))};this.rafId=requestAnimationFrame(t)},stopRaf(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)},onTouchMove(t){if(!this.isActive)return;if(!e.revisionMode){this.reset();return}if(t.touches.length!==1)return;const i=t.touches[0],s=i.clientX-this.startX,n=i.clientY-this.startY;if(!this.hasMovedHorizontally){const r=Math.abs(s),l=Math.abs(n);if(l>r&&l>10){this.reset();return}r>l&&r>10&&(this.hasMovedHorizontally=!0)}this.hasMovedHorizontally&&t.preventDefault(),this.currentX=i.clientX,this.currentY=i.clientY,this.deltaX=s,this.deltaY=n;const o=Date.now();this.velocityHistory.push({x:this.deltaX,y:this.deltaY,time:o}),this.velocityHistory.length>this.VELOCITY_SAMPLES&&this.velocityHistory.shift()},onTouchEnd(){if(this.stopRaf(),!this.isActive)return;const t=this.calculateVelocity(),i=this.getThreshold(),s=Math.abs(t);let n=null;s>this.VELOCITY_THRESHOLD?n=t>0?"ok":"review":Math.abs(this.deltaX)>i&&(n=this.deltaX>0?"ok":"review"),n?this.completeSwipe(n):this.snapBack()},onTouchCancel(){this.stopRaf(),this.snapBack()},calculateVelocity(){if(this.velocityHistory.length<2)return 0;const t=this.velocityHistory.slice(-3);if(t.length<2)return 0;const i=t[0],s=t[t.length-1],n=s.time-i.time;return n===0?0:(s.x-i.x)/n},updateCardTransform(){if(!this.cardShell)return;const t=this.getThreshold(),i=this.deltaX/t*this.MAX_ROTATION,s=Math.max(-this.MAX_ROTATION,Math.min(this.MAX_ROTATION,i)),n=this.deltaY*this.VERTICAL_FACTOR;this.cardShell.style.transform=`translate3d(${this.deltaX}px, ${n}px, 0) rotate(${s}deg)`},updateZones(){if(!this.zoneOk||!this.zoneReview)return;const t=this.getThreshold(),s=Math.abs(this.deltaX)/t>=1;this.deltaX>0?(s?this.zoneOk.classList.add("active"):this.zoneOk.classList.remove("active"),this.zoneReview.classList.remove("active")):this.deltaX<0?(s?this.zoneReview.classList.add("active"):this.zoneReview.classList.remove("active"),this.zoneOk.classList.remove("active")):(this.zoneOk.classList.remove("active"),this.zoneReview.classList.remove("active"))},completeSwipe(t){if(!this.cardShell){this.reset();return}const i=this.deltaX,s=this.deltaY*this.VERTICAL_FACTOR,n=this.getThreshold(),o=this.deltaX/n*this.MAX_ROTATION,r=Math.max(-this.MAX_ROTATION,Math.min(this.MAX_ROTATION,o));this.cardShell.classList.remove("swiping"),this.zoneOk&&this.zoneOk.classList.remove("active"),this.zoneReview&&this.zoneReview.classList.remove("active"),this.cardShell.style.setProperty("--swipe-start-x",`${i}px`),this.cardShell.style.setProperty("--swipe-start-y",`${s}px`),this.cardShell.style.setProperty("--swipe-start-rotation",`${r}deg`),this.cardShell.style.transform="",this.cardShell.offsetWidth;const l=t==="ok"?"swipe-exit-right":"swipe-exit-left";this.cardShell.classList.add("swipe-exit",l),e.isTransitioning=!0,this.isActive=!1,document.body.classList.remove("revision-active"),this.handleSwipeTransition(t)},async handleSwipeTransition(t){try{const i=U(500),s=p();if(s&&(t==="ok"?(e.revisionIncorrect.delete(s),e.revisionMastered.add(s),e.revisionSeen.add(s)):(e.revisionIncorrect.add(s),e.revisionSeen.add(s),e.revisionMastered.delete(s)),oe()),Ee()){await i,this.resetCardTransform(),e.isTransitioning=!1,V();return}const n=e.deck.filter(m=>!e.revisionSeen.has(m));if(n.length===0){await i,this.resetCardTransform(),e.isTransitioning=!1,V();return}const o=Math.floor(Math.random()*n.length),r=n[o],l=Promise.all([A(r),X(r)]),a=Promise.race([l,U(800).then(()=>null)]),[,c]=await Promise.all([i,a]);e.history.push(r),e.history.length>M?(e.history.shift(),e.historyIndex=M-1):e.historyIndex++,e.unvisited.delete(r),z(),this.cardShell.style.transition="none",this.cardShell.style.opacity="0",this.cardShell.style.visibility="hidden",this.cardShell.offsetWidth,this.resetCardTransform(),this.cardShell.offsetWidth;const h=d("#frontImg"),u=d("#backImg");if(e.flipped){const m=d("#card3d");m.classList.add("no-anim"),m.classList.remove("flipped","flipping"),m.setAttribute("aria-pressed","false"),e.flipped=!1,m.offsetHeight,m.classList.remove("no-anim")}let v={src:"",ok:!1},y={src:"",ok:!1};if(c)[v,y]=c;else{const m=await A(r,{probe:!1}),S=await X(r,{probe:!1});v=m,y=S}h.src=v.src,u.src=y.src,c?(h.classList.add("loaded"),u.classList.add("loaded")):(h.classList.remove("loaded"),u.classList.remove("loaded"),h.complete?h.classList.add("loaded"):h.onload=()=>h.classList.add("loaded"),u.complete?u.classList.add("loaded"):u.onload=()=>u.classList.add("loaded")),v.ok?(e.sizes[r]={w:v.width,h:v.height},F(v.width,v.height)):y.ok&&(e.sizes[r]={w:y.width,h:y.height},F(y.width,y.height)),x(),st(r),this.cardShell.classList.add("scaling-in"),await new Promise(m=>requestAnimationFrame(()=>requestAnimationFrame(m))),this.cardShell.style.visibility="",this.cardShell.style.opacity="",e.isTransitioning=!1,await U(400),this.cardShell.classList.remove("scaling-in"),this.cardShell.style.transition=""}catch(i){console.error("Swipe transition error:",i),this.resetCardTransform(),e.isTransitioning=!1,k()}},snapBack(){if(!this.cardShell){this.reset();return}this.zoneOk&&this.zoneOk.classList.remove("active"),this.zoneReview&&this.zoneReview.classList.remove("active"),this.cardShell.classList.remove("swiping"),this.cardShell.classList.add("snap-back"),this.cardShell.style.transform="",setTimeout(()=>{this.cardShell&&this.cardShell.classList.remove("snap-back"),this.reset()},300)},reset(){this.stopRaf(),this.isActive=!1,this.deltaX=0,this.deltaY=0,this.velocityHistory=[],this.hasMovedHorizontally=!1,document.body.classList.remove("revision-active"),this.cardShell&&this.cardShell.classList.remove("swiping"),this.zoneOk&&this.zoneOk.classList.remove("active"),this.zoneReview&&this.zoneReview.classList.remove("active")},resetCardTransform(){this.cardShell&&(this.cardShell.style.transform="",this.cardShell.classList.remove("swiping","snap-back","swipe-exit","swipe-exit-left","swipe-exit-right"),this.cardShell.style.removeProperty("--swipe-start-x"),this.cardShell.style.removeProperty("--swipe-start-y"),this.cardShell.style.removeProperty("--swipe-start-rotation")),this.zoneOk&&this.zoneOk.classList.remove("active"),this.zoneReview&&this.zoneReview.classList.remove("active")}},ct=Object.freeze(Object.defineProperty({__proto__:null,swipeGesture:se},Symbol.toStringTag,{value:"Module"}));function jt(){d("#cardShell").addEventListener("click",()=>{se&&se.hasMovedHorizontally||e.isTransitioning||K(!e.flipped)});const i=d("#bookmarkBtn");i&&i.addEventListener("click",()=>{const f=p();f&&(De(f),ee(),ge())});const s=d("#nextBtn");s&&s.addEventListener("click",()=>{L(T.nextButton,{mode:e.revisionMode?"revision":"lecture"}),we()}),d("#prevBtn").addEventListener("click",ke);const n=d("#pasOkBtn"),o=d("#okBtn");n&&n.addEventListener("click",Xe),o&&o.addEventListener("click",He);const r=d("#modeToggle");r&&r.addEventListener("click",()=>{Ve(),L(T.modeToggle,{mode:e.revisionMode?"revision":"lecture"})});const l=d("#restartRevisionBtn"),a=d("#backToLectureBtn");l&&l.addEventListener("click",()=>{Ne();const f=d("#revisionCompleteModal");N(f,!1)}),a&&a.addEventListener("click",()=>{const f=d("#revisionCompleteModal");N(f,!1),Ve()});const c=d("#dismissWelcomeBtn");c&&c.addEventListener("click",Yt);const h=d("#restartRevisionInlineBtn");h&&h.addEventListener("click",()=>{confirm("Recommencer la révision depuis le début ?")&&Ne()});const u=d("#randomToggle");u&&(u.addEventListener("click",()=>{if(u.classList.contains("disabled"))return;const f=e.shuffle;Z(),e.shuffle!==f&&L(T.randomToggle,{enabled:e.shuffle,mode:e.revisionMode?"revision":"lecture"})}),u.addEventListener("keydown",f=>{if(!u.classList.contains("disabled")&&(f.key==="Enter"||f.key===" ")){f.preventDefault();const g=e.shuffle;Z(),e.shuffle!==g&&L(T.randomToggle,{enabled:e.shuffle,mode:e.revisionMode?"revision":"lecture"})}}));const v=d("#favouritesToggle");v&&(v.addEventListener("click",()=>{const f=e.showFavouritesOnly;he(),e.showFavouritesOnly!==f&&L(T.favouritesToggle,{enabled:e.showFavouritesOnly,mode:e.revisionMode?"revision":"lecture"})}),v.addEventListener("keydown",f=>{if(f.key==="Enter"||f.key===" "){f.preventDefault();const g=e.showFavouritesOnly;he(),e.showFavouritesOnly!==g&&L(T.favouritesToggle,{enabled:e.showFavouritesOnly,mode:e.revisionMode?"revision":"lecture"})}}));const y=d("#timerFilter");y.addEventListener("click",G);const m=y?y.closest(".filter-group"):null;m&&m.addEventListener("click",f=>{y.contains(f.target)||G()}),y.addEventListener("keydown",f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),G())});const S=d("#difficultyFilter");S.addEventListener("click",J);const w=S?S.closest(".filter-group"):null;w&&w.addEventListener("click",f=>{S.contains(f.target)||J()}),S.addEventListener("keydown",f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),J())}),window.addEventListener("keydown",f=>{if(!(f.target&&["INPUT","TEXTAREA","SELECT","BUTTON"].includes(f.target.tagName))){if(e.revisionMode)f.key==="ArrowLeft"?Xe():f.key==="ArrowRight"?He():f.key===" "&&(f.preventDefault(),e.isTransitioning||K(!e.flipped));else if(f.key==="ArrowRight")we();else if(f.key==="ArrowLeft")ke();else if(f.key===" ")f.preventDefault(),e.isTransitioning||K(!e.flipped);else if(f.key.toLowerCase()==="r"&&!f.ctrlKey&&!f.metaKey&&!e.showFavouritesOnly)Z();else if(f.key.toLowerCase()==="f"&&!f.ctrlKey&&!f.metaKey)he();else if(f.key.toLowerCase()==="b"&&!f.ctrlKey&&!f.metaKey){const g=p();g&&(De(g),ee(),ge())}}})}function Yt(){const t=d("#welcomeModal");t&&(N(t,!1),localStorage.setItem("fc_welcome_modal_version",yt))}function Qt(){const t=document.getElementById("infoBtn"),i=document.getElementById("helpTooltip");if(t&&i){let s=!1,n=null;const o=()=>{i.style.position="",i.style.top="",i.style.left="",i.style.right="",i.style.bottom="",i.style.removeProperty("--tooltip-offset-x"),i.dataset.placement="bottom"},r=()=>{s&&(s=!1,i.classList.add("hidden"),i.setAttribute("aria-hidden","true"),n!==null&&(cancelAnimationFrame(n),n=null),o())},l=()=>{if(!s)return;const u=12,v=t.getBoundingClientRect();i.style.position="fixed",i.style.right="auto",i.style.bottom="auto",i.dataset.placement="bottom";const y=v.left+v.width/2;i.style.left=`${y}px`,i.style.setProperty("--tooltip-offset-x","0px");const m=i.getBoundingClientRect(),S=window.innerWidth,w=window.innerHeight,f=m.width/2,g=y-f,b=y+f,_=Math.max(u-g,0),O=Math.max(b-(S-u),0),dt=_-O;i.style.setProperty("--tooltip-offset-x",`${dt}px`);let R=v.bottom+u,Re="bottom";if(R+m.height>w-u){const Fe=v.top-u-m.height;Fe>=u?(R=Fe,Re="top"):R=Math.max(u,w-m.height-u)}const ft=u,ut=Math.max(u,w-m.height-u);R=Math.min(Math.max(R,ft),ut),i.style.top=`${R}px`,i.dataset.placement=Re},a=()=>{s&&n===null&&(n=requestAnimationFrame(()=>{n=null,l()}))},c=()=>{s||(s=!0,i.classList.remove("hidden"),i.setAttribute("aria-hidden","false"),a())};t.addEventListener("click",u=>{u.stopPropagation(),s?r():c()}),document.addEventListener("click",u=>{!t.contains(u.target)&&!i.contains(u.target)&&r()}),document.addEventListener("keydown",u=>{u.key==="Escape"&&s&&(r(),t.focus())});const h=()=>{s&&a()};window.addEventListener("resize",h,{passive:!0}),window.addEventListener("scroll",h,{passive:!0})}}function qt(){try{("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&document.documentElement.classList.add("is-touch")}catch{}}function Wt(t){const i=d("#chapterSelect");i.innerHTML="",t.forEach(o=>{const r=document.createElement("option");r.value=String(o),r.textContent=`Chapitre ${o}`,i.appendChild(r)});const n=t[t.length-1];return i.value=String(n),i.addEventListener("change",async o=>{const r=parseInt(o.target.value,10);await lt(r)}),n}async function Ut(){qt(),e.revisionMode&&document.body.classList.add("mode-revision"),jt(),Qt(),se.init(),Y(),ae(),j(),_e(),Me(),re();const t=await $t();if(!t.length){E(),d("#counter").textContent="Aucun chapitre trouvé (dossier 'flashcards/chN_cartes').";return}const i=Wt(t);await lt(i)}Ut();
